rumBukkaApp.controller('addPersonController', function ($scope, $route, $routeParams, $location, userData, $window, $rootScope,organisationData) {
	
	$scope.userTypes = ["Hons","Masters","PHD", "Faculty"]

	organisationData.getOrganisations().$promise.then(function(orgs){
	
	    $scope.orgs = orgs;   
	    
	    if($routeParams.userid != null)
	    {	    
	      userData.getUser($routeParams.userid).$promise.then(function(user){
		$scope.user = user;
		//$scope.user.Organisation = $scope.user.Organisation.OrganisationName;
		$scope.user.Type = $scope.userTypes[$scope.user.Type];
	      })
	      
	    }else
	    {
	      
	    $scope.user.FirstName = $scope.getName(0);
	    $scope.user.LastName = $scope.getName(1);
	    }
	
	
	});

	$scope.getName = function(index) {
		var name = $routeParams.userName;
		return name.split(' ')[index];
	}

	//submit function
	$scope.submit = function(){
	    $scope.user.Type = $scope.userTypes.indexOf($scope.user.Type)
	    userData.addUser($scope.user).$promise.then(function(user){
		console.log(user + " " + user.Student_Id);
		$location.url("addBooking/"+ user.Student_Id)      	
	    });
	}
	
	$scope.debug = function(){
	    alert($scope.user.Organisation.OrganisationName)
	}
	
	$scope.reversed = false;

	$scope.reverse = function(){
	    if(!$scope.reversed && $scope.user.LastName == ''){	
		$scope.user.LastName = $scope.user.FirstName;
		$scope.user.FirstName = "";
		$scope.reversed = true;
	    }

	}


});
